#!/usr/bin/env bash
set -euf -o pipefail
device_common_install_sh_lib_dir="$("$(dirname "$0")/pkg-nsf-device-common-install-get-sh-lib-dir")"
. "$device_common_install_sh_lib_dir/tools.sh"
ensure_run_from_nixos_live_cd

_effect() { 1>&2 echo "$" "$@"; "$@"; }

declare block_devices=( "$@" )


declare device
for device in "${block_devices[@]}"; do
  _effect parted -s "$device" -- mklabel gpt
  _effect parted -s --align=opt "$device" -- mkpart primary "0%" "100%"
  # Print the resulting partition table.
  _effect parted "$device" -- print
done
